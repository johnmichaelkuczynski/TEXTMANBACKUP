================================================================================
DATABASE SCHEMA REPORT
Generated from shared/schema.ts
================================================================================

STEP 2: TABLES THE CODE EXPECTS
===============================

The application expects 25 tables based on shared/schema.ts:


TABLE 1: users
--------------
| Column         | Type      | Notes                    |
|----------------|-----------|--------------------------|
| id             | serial    | PRIMARY KEY              |
| username       | text      | NOT NULL, UNIQUE         |
| password       | text      | NOT NULL                 |
| email          | text      | optional                 |
| created_at     | timestamp | NOT NULL, DEFAULT NOW    |
| last_active_at | timestamp | NOT NULL, DEFAULT NOW    |


TABLE 2: documents
------------------
| Column              | Type      | Notes                 |
|---------------------|-----------|----------------------|
| id                  | serial    | PRIMARY KEY          |
| content             | text      | NOT NULL             |
| original_content    | text      |                      |
| filename            | text      |                      |
| mime_type           | text      |                      |
| user_id             | integer   | FK -> users.id       |
| word_count          | integer   |                      |
| math_notation_count | integer   |                      |
| complexity          | text      |                      |
| created_at          | timestamp | NOT NULL, DEFAULT NOW|
| ai_probability      | integer   |                      |
| is_ai               | boolean   |                      |


TABLE 3: analyses
-----------------
| Column             | Type      | Notes                      |
|--------------------|-----------|---------------------------|
| id                 | serial    | PRIMARY KEY               |
| document_id        | integer   | FK -> documents.id, NOT NULL |
| user_id            | integer   | FK -> users.id            |
| summary            | text      | NOT NULL                  |
| overall_score      | integer   | NOT NULL                  |
| overall_assessment | text      | NOT NULL                  |
| dimensions         | jsonb     | NOT NULL                  |
| cognitive_patterns | jsonb     |                           |
| writing_style      | jsonb     |                           |
| created_at         | timestamp | NOT NULL, DEFAULT NOW     |


TABLE 4: intelligent_rewrites
-----------------------------
| Column                 | Type      | Notes                         |
|------------------------|-----------|------------------------------|
| id                     | serial    | PRIMARY KEY                  |
| original_document_id   | integer   | FK -> documents.id, NOT NULL |
| rewritten_document_id  | integer   | FK -> documents.id, NOT NULL |
| original_analysis_id   | integer   | FK -> analyses.id, NOT NULL  |
| rewritten_analysis_id  | integer   | FK -> analyses.id, NOT NULL  |
| user_id                | integer   | FK -> users.id               |
| provider               | text      | NOT NULL                     |
| custom_instructions    | text      |                              |
| original_score         | integer   | NOT NULL                     |
| rewritten_score        | integer   | NOT NULL                     |
| score_improvement      | integer   | NOT NULL                     |
| rewrite_report         | text      | NOT NULL                     |
| created_at             | timestamp | NOT NULL, DEFAULT NOW        |


TABLE 5: comparisons
--------------------
| Column                  | Type      | Notes                        |
|-------------------------|-----------|------------------------------|
| id                      | serial    | PRIMARY KEY                  |
| document_a_id           | integer   | FK -> documents.id, NOT NULL |
| document_b_id           | integer   | FK -> documents.id, NOT NULL |
| analysis_a_id           | integer   | FK -> analyses.id, NOT NULL  |
| analysis_b_id           | integer   | FK -> analyses.id, NOT NULL  |
| user_id                 | integer   | FK -> users.id               |
| comparison_results      | jsonb     | NOT NULL                     |
| improvement_suggestions | jsonb     |                              |
| created_at              | timestamp | NOT NULL, DEFAULT NOW        |


TABLE 6: case_assessments
-------------------------
| Column              | Type      | Notes                        |
|---------------------|-----------|------------------------------|
| id                  | serial    | PRIMARY KEY                  |
| document_id         | integer   | FK -> documents.id, NOT NULL |
| user_id             | integer   | FK -> users.id               |
| proof_effectiveness | integer   | NOT NULL                     |
| claim_credibility   | integer   | NOT NULL                     |
| non_triviality      | integer   | NOT NULL                     |
| proof_quality       | integer   | NOT NULL                     |
| functional_writing  | integer   | NOT NULL                     |
| overall_case_score  | integer   | NOT NULL                     |
| detailed_assessment | text      | NOT NULL                     |
| created_at          | timestamp | NOT NULL, DEFAULT NOW        |


TABLE 7: user_activities
------------------------
| Column           | Type      | Notes                 |
|------------------|-----------|----------------------|
| id               | serial    | PRIMARY KEY          |
| user_id          | integer   | FK -> users.id       |
| activity_type    | text      | NOT NULL             |
| activity_data    | jsonb     |                      |
| document_id      | integer   | FK -> documents.id   |
| session_duration | integer   |                      |
| timestamp        | timestamp | NOT NULL, DEFAULT NOW|


TABLE 8: cognitive_profiles
---------------------------
| Column                     | Type      | Notes                  |
|----------------------------|-----------|------------------------|
| id                         | serial    | PRIMARY KEY            |
| user_id                    | integer   | FK -> users.id, UNIQUE |
| writing_patterns           | jsonb     |                        |
| intellectual_interests     | jsonb     |                        |
| cognitive_style            | jsonb     |                        |
| learning_behavior          | jsonb     |                        |
| document_preferences       | jsonb     |                        |
| collaboration_style        | jsonb     |                        |
| conceptual_complexity      | text      |                        |
| attention_to_detail        | integer   |                        |
| creativity_index           | integer   |                        |
| systematic_thinking        | integer   |                        |
| average_session_length     | integer   |                        |
| total_documents_processed  | integer   |                        |
| preferred_ai_provider      | text      |                        |
| productivity_pattern       | jsonb     |                        |
| last_updated               | timestamp | NOT NULL, DEFAULT NOW  |
| created_at                 | timestamp | NOT NULL, DEFAULT NOW  |


TABLE 9: rewrite_jobs
---------------------
| Column             | Type      | Notes                     |
|--------------------|-----------|---------------------------|
| id                 | serial    | PRIMARY KEY               |
| input_text         | text      | NOT NULL                  |
| style_text         | text      |                           |
| content_mix_text   | text      |                           |
| custom_instructions| text      |                           |
| selected_presets   | jsonb     |                           |
| provider           | text      | NOT NULL                  |
| chunks             | jsonb     |                           |
| selected_chunk_ids | jsonb     |                           |
| mixing_mode        | text      |                           |
| output_text        | text      |                           |
| input_ai_score     | integer   |                           |
| output_ai_score    | integer   |                           |
| status             | text      | NOT NULL, DEFAULT pending |
| created_at         | timestamp | NOT NULL, DEFAULT NOW     |


TABLE 10: user_credits
----------------------
| Column       | Type      | Notes                   |
|--------------|-----------|-------------------------|
| id           | serial    | PRIMARY KEY             |
| user_id      | integer   | FK -> users.id, NOT NULL|
| provider     | text      | NOT NULL                |
| credits      | integer   | NOT NULL, DEFAULT 0     |
| last_updated | timestamp | NOT NULL, DEFAULT NOW   |


TABLE 11: credit_transactions
-----------------------------
| Column                  | Type      | Notes                     |
|-------------------------|-----------|---------------------------|
| id                      | serial    | PRIMARY KEY               |
| user_id                 | integer   | FK -> users.id, NOT NULL  |
| provider                | text      | NOT NULL                  |
| amount                  | integer   | NOT NULL                  |
| credits                 | integer   | NOT NULL                  |
| transaction_type        | text      | NOT NULL                  |
| stripe_session_id       | text      |                           |
| stripe_payment_intent_id| text      |                           |
| status                  | text      | NOT NULL, DEFAULT pending |
| metadata                | jsonb     |                           |
| created_at              | timestamp | NOT NULL, DEFAULT NOW     |


TABLE 12: coherence_documents
-----------------------------
| Column         | Type      | Notes                 |
|----------------|-----------|----------------------|
| id             | serial    | PRIMARY KEY          |
| document_id    | text      | NOT NULL             |
| coherence_mode | text      | NOT NULL             |
| global_state   | jsonb     | NOT NULL             |
| created_at     | timestamp | NOT NULL, DEFAULT NOW|
| updated_at     | timestamp | NOT NULL, DEFAULT NOW|


TABLE 13: coherence_chunks
--------------------------
| Column            | Type      | Notes                 |
|-------------------|-----------|----------------------|
| id                | serial    | PRIMARY KEY          |
| document_id       | text      | NOT NULL             |
| coherence_mode    | text      | NOT NULL             |
| chunk_index       | integer   | NOT NULL             |
| chunk_text        | text      |                      |
| evaluation_result | jsonb     |                      |
| state_after       | jsonb     |                      |
| created_at        | timestamp | NOT NULL, DEFAULT NOW|


TABLE 14: system_instructions
-----------------------------
| Column      | Type      | Notes                 |
|-------------|-----------|----------------------|
| id          | serial    | PRIMARY KEY          |
| category    | text      | NOT NULL             |
| title       | text      | NOT NULL             |
| content     | text      | NOT NULL             |
| subcategory | text      |                      |
| version     | text      | DEFAULT 1.0          |
| created_at  | timestamp | NOT NULL, DEFAULT NOW|
| updated_at  | timestamp | NOT NULL, DEFAULT NOW|


TABLE 15: reconstruction_documents
----------------------------------
| Column              | Type      | Notes                              |
|---------------------|-----------|------------------------------------|
| id                  | serial    | PRIMARY KEY                        |
| user_id             | integer   | FK -> users.id                     |
| title               | text      |                                    |
| original_text       | text      | NOT NULL                           |
| word_count          | integer   | NOT NULL                           |
| global_skeleton     | jsonb     |                                    |
| final_output        | text      |                                    |
| final_word_count    | integer   |                                    |
| validation_result   | jsonb     |                                    |
| status              | text      | DEFAULT pending                    |
| target_min_words    | integer   |                                    |
| target_max_words    | integer   |                                    |
| target_mid_words    | integer   |                                    |
| length_ratio        | real      |                                    |
| length_mode         | text      |                                    |
| chunk_target_words  | integer   |                                    |
| num_chunks          | integer   |                                    |
| current_chunk       | integer   | DEFAULT 0                          |
| audience_parameters | text      |                                    |
| rigor_level         | text      |                                    |
| custom_instructions | text      |                                    |
| error_message       | text      |                                    |
| aborted_at          | timestamp |                                    |
| created_at          | timestamp | NOT NULL, DEFAULT NOW              |
| updated_at          | timestamp | NOT NULL, DEFAULT NOW              |


TABLE 16: reconstruction_chunks
-------------------------------
| Column             | Type      | Notes                                        |
|--------------------|-----------|----------------------------------------------|
| id                 | serial    | PRIMARY KEY                                  |
| document_id        | integer   | FK -> reconstruction_documents.id, NOT NULL  |
| chunk_index        | integer   | NOT NULL                                     |
| chunk_input_text   | text      | NOT NULL                                     |
| chunk_input_words  | integer   |                                              |
| chunk_output_text  | text      |                                              |
| actual_words       | integer   |                                              |
| target_words       | integer   |                                              |
| min_words          | integer   |                                              |
| max_words          | integer   |                                              |
| chunk_delta        | jsonb     |                                              |
| conflicts_detected | jsonb     |                                              |
| status             | text      | DEFAULT pending                              |
| retry_count        | integer   | DEFAULT 0                                    |
| error_message      | text      |                                              |
| created_at         | timestamp | NOT NULL, DEFAULT NOW                        |
| updated_at         | timestamp | NOT NULL, DEFAULT NOW                        |


TABLE 17: reconstruction_runs
-----------------------------
| Column      | Type      | Notes                                        |
|-------------|-----------|----------------------------------------------|
| id          | serial    | PRIMARY KEY                                  |
| document_id | integer   | FK -> reconstruction_documents.id, NOT NULL  |
| run_type    | text      | NOT NULL                                     |
| chunk_index | integer   |                                              |
| run_input   | jsonb     |                                              |
| run_output  | jsonb     |                                              |
| duration_ms | integer   |                                              |
| created_at  | timestamp | NOT NULL, DEFAULT NOW                        |


TABLE 18: stitch_results
------------------------
| Column           | Type      | Notes                                        |
|------------------|-----------|----------------------------------------------|
| id               | serial    | PRIMARY KEY                                  |
| document_id      | integer   | FK -> reconstruction_documents.id, NOT NULL  |
| conflicts        | jsonb     |                                              |
| term_drift       | jsonb     |                                              |
| missing_premises | jsonb     |                                              |
| redundancies     | jsonb     |                                              |
| repair_plan      | jsonb     |                                              |
| coherence_score  | text      |                                              |
| final_validation | jsonb     |                                              |
| created_at       | timestamp | NOT NULL, DEFAULT NOW                        |


TABLE 19: hcc_documents
-----------------------
| Column              | Type      | Notes                 |
|---------------------|-----------|-----------------------|
| id                  | serial    | PRIMARY KEY           |
| user_id             | integer   | FK -> users.id        |
| title               | text      |                       |
| original_text       | text      | NOT NULL              |
| word_count          | integer   | NOT NULL              |
| structure_map       | jsonb     |                       |
| book_skeleton       | jsonb     |                       |
| final_output        | text      |                       |
| target_min_words    | integer   |                       |
| target_max_words    | integer   |                       |
| length_ratio        | text      |                       |
| length_mode         | text      |                       |
| status              | text      | DEFAULT pending       |
| custom_instructions | text      |                       |
| created_at          | timestamp | NOT NULL, DEFAULT NOW |
| updated_at          | timestamp | NOT NULL, DEFAULT NOW |


TABLE 20: hcc_parts
-------------------
| Column                   | Type      | Notes                            |
|--------------------------|-----------|----------------------------------|
| id                       | serial    | PRIMARY KEY                      |
| document_id              | integer   | FK -> hcc_documents.id, NOT NULL |
| part_index               | integer   | NOT NULL                         |
| part_title               | text      |                                  |
| original_text            | text      | NOT NULL                         |
| word_count               | integer   | NOT NULL                         |
| part_skeleton            | jsonb     |                                  |
| compressed_book_skeleton | jsonb     |                                  |
| part_output              | text      |                                  |
| part_delta               | jsonb     |                                  |
| status                   | text      | DEFAULT pending                  |
| created_at               | timestamp | NOT NULL, DEFAULT NOW            |


TABLE 21: hcc_chapters
----------------------
| Column                   | Type      | Notes                            |
|--------------------------|-----------|----------------------------------|
| id                       | serial    | PRIMARY KEY                      |
| part_id                  | integer   | FK -> hcc_parts.id, NOT NULL     |
| document_id              | integer   | FK -> hcc_documents.id, NOT NULL |
| chapter_index            | integer   | NOT NULL                         |
| chapter_title            | text      |                                  |
| original_text            | text      | NOT NULL                         |
| word_count               | integer   | NOT NULL                         |
| chapter_skeleton         | jsonb     |                                  |
| compressed_part_skeleton | jsonb     |                                  |
| chapter_output           | text      |                                  |
| chapter_delta            | jsonb     |                                  |
| status                   | text      | DEFAULT pending                  |
| created_at               | timestamp | NOT NULL, DEFAULT NOW            |


TABLE 22: hcc_chunks
--------------------
| Column             | Type      | Notes                              |
|--------------------|-----------|------------------------------------|
| id                 | serial    | PRIMARY KEY                        |
| chapter_id         | integer   | FK -> hcc_chapters.id, NOT NULL    |
| document_id        | integer   | FK -> hcc_documents.id, NOT NULL   |
| chunk_index        | integer   | NOT NULL                           |
| chunk_input_text   | text      | NOT NULL                           |
| chunk_input_words  | integer   | NOT NULL                           |
| chunk_output_text  | text      |                                    |
| chunk_output_words | integer   |                                    |
| target_words       | integer   |                                    |
| min_words          | integer   |                                    |
| max_words          | integer   |                                    |
| chunk_delta        | jsonb     |                                    |
| conflicts_detected | jsonb     |                                    |
| status             | text      | DEFAULT pending                    |
| created_at         | timestamp | NOT NULL, DEFAULT NOW              |


TABLE 23: pipeline_jobs
-----------------------
| Column               | Type      | Notes                 |
|----------------------|-----------|-----------------------|
| id                   | serial    | PRIMARY KEY           |
| user_id              | integer   | FK -> users.id        |
| original_text        | text      | NOT NULL              |
| original_word_count  | integer   | NOT NULL              |
| custom_instructions  | text      |                       |
| target_audience      | text      |                       |
| objective            | text      |                       |
| reconstruction_output| text      |                       |
| objections_output    | text      |                       |
| responses_output     | text      |                       |
| bulletproof_output   | text      |                       |
| skeleton_1           | jsonb     |                       |
| skeleton_2           | jsonb     |                       |
| skeleton_3           | jsonb     |                       |
| skeleton_4           | jsonb     |                       |
| current_stage        | integer   | DEFAULT 1             |
| stage_status         | text      | DEFAULT pending       |
| total_stages         | integer   | DEFAULT 4             |
| reconstruction_words | integer   |                       |
| objections_words     | integer   |                       |
| responses_words      | integer   |                       |
| bulletproof_words    | integer   |                       |
| hc_check_results     | jsonb     |                       |
| hc_violations        | jsonb     |                       |
| hc_repair_attempts   | integer   | DEFAULT 0             |
| stage1_start_time    | timestamp |                       |
| stage1_end_time      | timestamp |                       |
| stage2_start_time    | timestamp |                       |
| stage2_end_time      | timestamp |                       |
| stage3_start_time    | timestamp |                       |
| stage3_end_time      | timestamp |                       |
| stage4_start_time    | timestamp |                       |
| stage4_end_time      | timestamp |                       |
| hc_check_time        | timestamp |                       |
| status               | text      | DEFAULT pending       |
| error_message        | text      |                       |
| created_at           | timestamp | NOT NULL, DEFAULT NOW |
| updated_at           | timestamp | NOT NULL, DEFAULT NOW |


TABLE 24: pipeline_chunks
-------------------------
| Column           | Type      | Notes                           |
|------------------|-----------|---------------------------------|
| id               | serial    | PRIMARY KEY                     |
| job_id           | integer   | FK -> pipeline_jobs.id, NOT NULL|
| stage            | integer   | NOT NULL                        |
| chunk_index      | integer   | NOT NULL                        |
| chunk_input_text | text      |                                 |
| chunk_output_text| text      |                                 |
| chunk_delta      | jsonb     |                                 |
| target_words     | integer   |                                 |
| actual_words     | integer   |                                 |
| min_words        | integer   |                                 |
| max_words        | integer   |                                 |
| status           | text      | DEFAULT pending                 |
| retry_count      | integer   | DEFAULT 0                       |
| error_message    | text      |                                 |
| created_at       | timestamp | NOT NULL, DEFAULT NOW           |


TABLE 25: pipeline_objections
-----------------------------
| Column               | Type      | Notes                           |
|----------------------|-----------|---------------------------------|
| id                   | serial    | PRIMARY KEY                     |
| job_id               | integer   | FK -> pipeline_jobs.id, NOT NULL|
| objection_index      | integer   | NOT NULL                        |
| claim_targeted       | text      |                                 |
| claim_location       | text      |                                 |
| objection_type       | text      |                                 |
| objection_text       | text      |                                 |
| severity             | text      |                                 |
| initial_response     | text      |                                 |
| enhanced_response    | text      |                                 |
| enhancement_notes    | text      |                                 |
| integrated_in_section| text      |                                 |
| integration_strategy | text      |                                 |
| integration_verified | boolean   | DEFAULT false                   |
| created_at           | timestamp | NOT NULL, DEFAULT NOW           |


================================================================================
STEP 3: GAP ANALYSIS - DOES THE SCHEMA SUPPORT YOUR REQUIREMENTS?
================================================================================


LENGTH REQUIREMENTS: PARTIAL SUPPORT
------------------------------------

What exists:
- reconstruction_documents has: target_min_words, target_max_words, final_word_count, length_ratio, length_mode
- reconstruction_chunks has: target_words, min_words, max_words, actual_words
- Same pattern in hcc_* and pipeline_* tables

What's MISSING:
1. No length enforcement validation table - No table to record:
   - Whether target was met/failed
   - How many iterations were needed
   - Final pass/fail status for length
   - Explicit "output >= target" boolean flag

2. No retry-until-success tracking - The schema has retry_count but no mechanism to log each retry attempt with word counts

Recommendation: Add a length_enforcement_logs table to track every attempt and enforce the "keep generating until target met or fail explicitly" rule.


COHERENCE REQUIREMENTS: STRONG SUPPORT
--------------------------------------

What exists:
- Full skeleton storage (global_skeleton, book_skeleton, chapter_skeleton, etc.)
- Chunk state tracking (chunk_delta, conflicts_detected, state_after)
- Stitch results for cross-chunk validation (stitch_results)
- Hierarchical coherence (hcc_* tables for 100,000+ word documents)
- Pipeline coherence tracking (hc_check_results, hc_violations)

What's MISSING:
1. No per-LLM-call coherence state snapshot - The schema doesn't capture the exact coherence state BEFORE and AFTER each LLM call
2. No explicit coherence chain - No mechanism to prove chunk N's output was generated with chunk N-1's state

Recommendation: Add explicit coherence_state_before and coherence_state_after columns to chunk tables, or a dedicated coherence_snapshots table.


STORAGE REQUIREMENTS: PARTIAL SUPPORT
-------------------------------------

What exists:
- All documents, analyses, rewrites, chunks are stored with created_at
- Processing runs stored in reconstruction_runs

What's MISSING:
1. No intermediate output storage - If LLM produces partial output before failure, it's lost
2. No input echo storage - The exact prompt sent to LLM isn't stored
3. No error log table - Errors stored as single error_message text field, not as event log

Recommendation: Add an intermediate_outputs table for partial results and an error_logs table with full error details.


AUDIT REQUIREMENTS: NOT SUPPORTED
---------------------------------

This is the critical gap. The schema has NO audit logging infrastructure.

What's MISSING (everything):

1. No audit_events table - No central table for:
   - Every database query (SQL text)
   - Every table accessed (read/write)
   - Every row inserted/updated
   - Timestamps for every action

2. No llm_calls table - No table for:
   - Model name
   - Token counts (input/output)
   - Prompt text (or summary)
   - Response text (or summary)
   - Latency (ms)
   - Status (success/error)

3. No chunk_processing_logs table - No table for:
   - Chunk index
   - Input word count
   - Output word count
   - Target word count
   - Pass/fail status

4. No link between audit logs and outputs - No foreign key from outputs to their audit trail

5. No Job History mechanism - No dedicated table for users to retrieve past job audit logs


================================================================================
TABLES YOU NEED TO ADD
================================================================================


NEW TABLE 1: audit_events (Master Audit Log)
--------------------------------------------
id: serial PRIMARY KEY
user_id: integer FK -> users.id
job_id: integer (nullable, links to reconstruction/pipeline/hcc job)
job_type: text (reconstruction, pipeline, hcc, rewrite, analysis)
event_type: text (db_query, db_insert, db_update, llm_call, chunk_start, chunk_end, error, etc.)
event_data: jsonb (full details)
table_name: text (if db operation)
row_id: integer (if db operation)
sql_text: text (if db query)
timestamp: timestamp NOT NULL DEFAULT NOW


NEW TABLE 2: llm_calls (LLM Call Log)
-------------------------------------
id: serial PRIMARY KEY
user_id: integer FK -> users.id
job_id: integer (links to job)
job_type: text
audit_event_id: integer FK -> audit_events.id
model_name: text NOT NULL
provider: text NOT NULL
input_tokens: integer
output_tokens: integer
prompt_summary: text
prompt_full: text
response_summary: text
response_full: text
latency_ms: integer
status: text (success, error, timeout)
error_message: text
created_at: timestamp NOT NULL DEFAULT NOW


NEW TABLE 3: chunk_processing_logs (Chunk-Level Audit)
------------------------------------------------------
id: serial PRIMARY KEY
user_id: integer FK -> users.id
job_id: integer
job_type: text
chunk_index: integer NOT NULL
input_word_count: integer NOT NULL
output_word_count: integer NOT NULL
target_word_count: integer NOT NULL
min_word_count: integer
max_word_count: integer
passed: boolean NOT NULL
failure_reason: text
retry_number: integer DEFAULT 0
llm_call_id: integer FK -> llm_calls.id
created_at: timestamp NOT NULL DEFAULT NOW


NEW TABLE 4: length_enforcement_logs (Length Target Tracking)
-------------------------------------------------------------
id: serial PRIMARY KEY
user_id: integer FK -> users.id
job_id: integer NOT NULL
job_type: text NOT NULL
target_words: integer NOT NULL
final_words: integer
target_met: boolean
iterations_required: integer
failure_reason: text
created_at: timestamp NOT NULL DEFAULT NOW


NEW TABLE 5: job_history (User-Accessible Job History)
------------------------------------------------------
id: serial PRIMARY KEY
user_id: integer FK -> users.id NOT NULL
job_id: integer NOT NULL
job_type: text NOT NULL
job_title: text
input_summary: text
output_summary: text
input_word_count: integer
output_word_count: integer
target_word_count: integer
target_met: boolean
status: text NOT NULL
audit_log_downloadable: boolean DEFAULT true
created_at: timestamp NOT NULL DEFAULT NOW
completed_at: timestamp


================================================================================
SUMMARY
================================================================================

| Requirement          | Current Schema Status | What's Missing                           |
|----------------------|-----------------------|------------------------------------------|
| Length enforcement   | Partial               | No validation/retry logging, no pass/fail|
| Coherence            | Strong                | No per-call state snapshots              |
| Storage              | Partial               | No intermediate outputs, no prompt storage|
| Audit logging        | NOT SUPPORTED         | No audit tables exist at all             |

The schema needs 5 new tables to meet your requirements.

================================================================================
END OF REPORT
================================================================================
